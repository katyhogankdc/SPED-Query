# SPED-Query

```SQL
SELECT 
S.SYSTEMSTUDENTID
,SLED.PRIMARYDISABILITY AS CLASSIFICATION
,[IEPENDDATE] AS SPED_NEXTANNUALIEP
,PROJECTEDELIGIBILITYDATE AS SPED_PROJELIG
,TOTAL_HOURS_PER_WEEK AS SPED_TOTALHOURS
,SPECIAL_EDUCATION_LEVEL AS SPED_FUNDING
,TOTAL_HOURS_OUT_OF_GEN_ED_SETTING AS SPED_SPEDHOURS
,TOTAL_HOURS_IN_GEN_ED_SETTING AS SPED_GENEDHOURS
,TOTAL_HOURS_OUT_OF_GEN_ED_SETTING/32.5 AS SPED_PERCENTOUTGENED
--,CASE 
--	WHEN TOTAL_HOURS_OUT_OF_GEN_ED_SETTING/32.5<=0.2 THEN 'Tier A'
--	WHEN TOTAL_HOURS_OUT_OF_GEN_ED_SETTING/32.5<=0.6 THEN 'Tier B'
--	WHEN TOTAL_HOURS_OUT_OF_GEN_ED_SETTING/32.5<=1.0 THEN 'Tier C'
--	ELSE NULL 
--	END AS SPED_LRETIER
,CASE
	WHEN ENVIRONMENT LIKE 'A %' THEN 'Tier A'
	WHEN ENVIRONMENT LIKE 'B %' THEN 'Tier B'
	WHEN ENVIRONMENT LIKE 'C %' THEN 'Tier C'
	WHEN ENVIRONMENT = 'Separate School' THEN 'OSSE'
	WHEN ENVIRONMENT = 'In regular early childhood program at least 10 hours/week and most special education services provided outside general education setting' THEN 'ECE>5'
	WHEN ENVIRONMENT = 'In regular early childhood program at least 10 hours/week and most special education services provided in general education setting' THEN 'ECE<5'
	WHEN ENVIRONMENT = 'Separate class' THEN 'ECETLC'
	WHEN ENVIRONMENT = 'Homebound/Hospital' THEN 'HOME'
 	WHEN ENVIRONMENT = 'In regular early childhood program less than 10 hours/week and most special education services provided in general education setting' THEN 'ERROR'
	ELSE NULL
 END AS SPED_LRETIER
,SPED_SPINSTSPED
,SPED_SPINSTGENED
,DEDICATED_AIDE_HOURS AS SPED_DEDICATEDAIDEHRS
,SPED_RELATED_BEHAVIOR
,SPED_RELATED_SPEECH
,SPED_RELATED_OT
,SPED_RELATED_PT
,SPED_RELATED_AUDIOLOGY
,SPED_Related_Behavior_Outside
,SPED_Related_Speech_Outside
,SPED_Related_OT_Outside
,SPED_Related_PT_Outside
,SPED_Related_Audiology_Outside
,SPED_Related_Behavior_GenEd
,SPED_Related_Speech_GenEd
,SPED_Related_OT_GenEd
,SPED_Related_PT_GenEd
,SPED_Related_Audiology_GenEd
--,ADD APE
--,CASE 
--	WHEN TRANSPO.TRANSPORT_NEEDED = 'Yes' then 1
--	ELSE NULL END TRANSPORTATION
,NULL TRANSPORTATION
,CASE
	WHEN ISR.ID IS NOT NULL THEN 'Yes'
	ELSE NULL END AS ISR
FROM [DW].[DW_DIMSTUDENT] S
LEFT JOIN [CUSTOM].[SPED_SPECIAL_EDUCATION_ROSTER_REPORT] SLED ON SLED.USI=S.STATESTUDENTID AND SLED.LASTUPDATED='2016-10-15'
--LEFT JOIN [CUSTOM].[SPED_TRANSPORTATION_ROSTER] TRANSPO ON TRANSPO.USI=S.STATESTUDENTID AND TRANSPO.LASTUPDATED='${LastUpdated}'
LEFT JOIN (SELECT distinct sp.id AS ID
				,STUDENT_NUMBER
				FROM [powerschool].[PowerSchool_SPENROLLMENTS] sp
				JOIN [powerschool].[PowerSchool_STUDENTS] S ON studentid = s.id 
				WHERE exit_date='01-JAN-1900' AND programid = (SELECT id FROM powerschool.powerschool_gen WHERE cat='specprog' AND name='Learning Center')) ISR
				ON ISR.STUDENT_NUMBER=S.SYSTEMSTUDENTID
LEFT JOIN (SELECT 
			(str(SUM(TIME),3,1)  +' '+TIMEUNITS+'/'+TIMEFREQUENCY) AS SPED_SPINSTSPED
			,SEDS.STATEID 
			FROM [CUSTOM].[SPED_ALL_STUDENTS_WITH_DISABILITIES] SEDS 
			WHERE SEDS.[SERVICE]='SPECIALIZED INSTRUCTION' 
			AND SEDS.SERVICELOCATION='OUTSIDE GENERAL EDUCATION'
			AND SEDS.LASTUPDATED='2016-10-15'
			AND EXTENDEDSCHOOLYEAR !='Yes'
			AND SEDS.SERVICELOCATION IS NOT NULL
			GROUP BY TIMEUNITS,TIMEFREQUENCY,STATEID
			) SI_SPED ON SI_SPED.STATEID=S.STATESTUDENTID
LEFT JOIN (SELECT 
			(str(SUM(TIME),3,1) +' '+TIMEUNITS+'/'+TIMEFREQUENCY) AS SPED_SPINSTGENED
			,SEDS.STATEID 
			FROM [CUSTOM].[SPED_ALL_STUDENTS_WITH_DISABILITIES] SEDS 
			WHERE SEDS.[SERVICE]='SPECIALIZED INSTRUCTION' AND SEDS.SERVICELOCATION='GENERAL EDUCATION'
			AND SEDS.LASTUPDATED='2016-10-15'
			AND EXTENDEDSCHOOLYEAR !='Yes'
			AND SEDS.SERVICELOCATION IS NOT NULL
			GROUP BY TIMEUNITS,TIMEFREQUENCY,STATEID
			) SI_GENED ON SI_GENED.STATEID=S.STATESTUDENTID
LEFT JOIN (SELECT
			(str(SUM(TIME),3,1)  +' '+TIMEUNITS+'/'+TIMEFREQUENCY) AS SPED_RELATED_BEHAVIOR
			,SEDS.STATEID 
			FROM [CUSTOM].[SPED_ALL_STUDENTS_WITH_DISABILITIES] SEDS 
			WHERE SEDS.[SERVICE]='BEHAVIORAL SUPPORT SERVICES'
			AND SEDS.LASTUPDATED='2016-10-15'
			AND EXTENDEDSCHOOLYEAR != 'Yes'
			AND SEDS.SERVICELOCATION IS NOT NULL
			GROUP BY TIMEUNITS,TIMEFREQUENCY,STATEID
			) BSS_SPED ON BSS_SPED.STATEID=S.STATESTUDENTID
LEFT JOIN (SELECT 
			(str(SUM(TIME),3,1)  +' '+TIMEUNITS+'/'+TIMEFREQUENCY) AS SPED_RELATED_SPEECH
			,SEDS.STATEID 
			FROM [CUSTOM].[SPED_ALL_STUDENTS_WITH_DISABILITIES] SEDS 
			WHERE SEDS.[SERVICE]='SPEECH-LANGUAGE PATHOLOGY'
			AND SEDS.LASTUPDATED='2016-10-15'
			AND EXTENDEDSCHOOLYEAR !='Yes'
			AND SEDS.SERVICELOCATION IS NOT NULL
			GROUP BY TIMEUNITS,TIMEFREQUENCY,STATEID
			) SP_SPED ON SP_SPED.STATEID=S.STATESTUDENTID
LEFT JOIN (SELECT 
		    (str(SUM(TIME),3,1)  +' '+TIMEUNITS+'/'+TIMEFREQUENCY) AS SPED_RELATED_OT
			,SEDS.STATEID 
			FROM [CUSTOM].[SPED_ALL_STUDENTS_WITH_DISABILITIES] SEDS 
			WHERE SEDS.[SERVICE]='OCCUPATIONAL THERAPY' 
			AND SEDS.LASTUPDATED='2016-10-15'
			AND EXTENDEDSCHOOLYEAR !='Yes'
			AND SEDS.SERVICELOCATION IS NOT NULL
			GROUP BY TIMEUNITS,TIMEFREQUENCY,STATEID
			) OT_SPED ON OT_SPED.STATEID=S.STATESTUDENTID
LEFT JOIN (SELECT 
			(str(SUM(TIME),3,1)  +' '+TIMEUNITS+'/'+TIMEFREQUENCY) AS SPED_RELATED_PT
			,SEDS.STATEID 
			FROM [CUSTOM].[SPED_ALL_STUDENTS_WITH_DISABILITIES] SEDS 
			WHERE SEDS.[SERVICE]='PHYSICAL THERAPY'
			AND SEDS.LASTUPDATED='2016-10-15'
			AND EXTENDEDSCHOOLYEAR !='Yes'
			AND SEDS.SERVICELOCATION IS NOT NULL
			GROUP BY TIMEUNITS,TIMEFREQUENCY,STATEID
			) PT_SPED ON PT_SPED.STATEID=S.STATESTUDENTID
LEFT JOIN (SELECT 
			(str(SUM(TIME),3,1)  +' '+TIMEUNITS+'/'+TIMEFREQUENCY) AS SPED_RELATED_AUDIOLOGY
			,SEDS.STATEID 
			FROM [CUSTOM].[SPED_ALL_STUDENTS_WITH_DISABILITIES] SEDS 
			WHERE SEDS.[SERVICE]='AUDIOLOGY'
			AND SEDS.LASTUPDATED='2016-10-15'
			AND EXTENDEDSCHOOLYEAR !='Yes'
			AND SEDS.SERVICELOCATION IS NOT NULL
			GROUP BY TIMEUNITS,TIMEFREQUENCY,STATEID) A_SPED ON A_SPED.STATEID=S.STATESTUDENTID
LEFT JOIN (SELECT 
			(str(SUM(TIME),3,1)  +' '+TIMEUNITS+'/'+TIMEFREQUENCY) AS SPED_Related_Behavior_Outside
			,SEDS.STATEID 
			FROM [CUSTOM].[SPED_ALL_STUDENTS_WITH_DISABILITIES] SEDS 
			WHERE SEDS.[SERVICE]='BEHAVIORAL SUPPORT SERVICES'
			AND SEDS.LASTUPDATED='2016-10-15'
			AND EXTENDEDSCHOOLYEAR !='Yes'
			AND SEDS.SERVICELOCATION = 'Outside General Education'
			GROUP BY TIMEUNITS,TIMEFREQUENCY,STATEID) BSSO_SPED ON BSSO_SPED.STATEID=S.STATESTUDENTID
LEFT JOIN (SELECT 
			(str(SUM(TIME),3,1)  +' '+TIMEUNITS+'/'+TIMEFREQUENCY) AS SPED_Related_Speech_Outside
			,SEDS.STATEID 
			FROM [CUSTOM].[SPED_ALL_STUDENTS_WITH_DISABILITIES] SEDS 
			WHERE SEDS.[SERVICE]='SPEECH-LANGUAGE PATHOLOGY'
			AND SEDS.LASTUPDATED='2016-10-15'
			AND EXTENDEDSCHOOLYEAR !='Yes'
			AND SEDS.SERVICELOCATION = 'Outside General Education'
			GROUP BY TIMEUNITS,TIMEFREQUENCY,STATEID) SLPO_SPED ON SLPO_SPED.STATEID=S.STATESTUDENTID
LEFT JOIN (SELECT 
			(str(SUM(TIME),3,1)  +' '+TIMEUNITS+'/'+TIMEFREQUENCY) AS SPED_Related_OT_Outside
			,SEDS.STATEID 
			FROM [CUSTOM].[SPED_ALL_STUDENTS_WITH_DISABILITIES] SEDS 
			WHERE SEDS.[SERVICE]='OCCUPATIONAL THERAPY'
			AND SEDS.LASTUPDATED='2016-10-15'
			AND EXTENDEDSCHOOLYEAR !='Yes'
			AND SEDS.SERVICELOCATION = 'Outside General Education'
			GROUP BY TIMEUNITS,TIMEFREQUENCY,STATEID) OTO_SPED ON OTO_SPED.STATEID=S.STATESTUDENTID
LEFT JOIN (SELECT 
			(str(SUM(TIME),3,1)  +' '+TIMEUNITS+'/'+TIMEFREQUENCY) AS SPED_Related_PT_Outside
			,SEDS.STATEID 
			FROM [CUSTOM].[SPED_ALL_STUDENTS_WITH_DISABILITIES] SEDS 
			WHERE SEDS.[SERVICE]='PHYSICAL THERAPY'
			AND SEDS.LASTUPDATED='2016-10-15'
			AND EXTENDEDSCHOOLYEAR !='Yes'
			AND SEDS.SERVICELOCATION = 'Outside General Education'
			GROUP BY TIMEUNITS,TIMEFREQUENCY,STATEID) PTO_SPED ON PTO_SPED.STATEID=S.STATESTUDENTID
LEFT JOIN (SELECT 
			(str(SUM(TIME),3,1)  +' '+TIMEUNITS+'/'+TIMEFREQUENCY) AS SPED_Related_Audiology_Outside
			,SEDS.STATEID 
			FROM [CUSTOM].[SPED_ALL_STUDENTS_WITH_DISABILITIES] SEDS 
			WHERE SEDS.[SERVICE]='AUDIOLOGY'
			AND SEDS.LASTUPDATED='2016-10-15'
			AND EXTENDEDSCHOOLYEAR !='Yes'
			AND SEDS.SERVICELOCATION = 'Outside General Education'
			GROUP BY TIMEUNITS,TIMEFREQUENCY,STATEID) AO_SPED ON AO_SPED.STATEID=S.STATESTUDENTID
LEFT JOIN (SELECT 
			(str(SUM(TIME),3,1)  +' '+TIMEUNITS+'/'+TIMEFREQUENCY) AS SPED_Related_Behavior_GenEd
			,SEDS.STATEID 
			FROM [CUSTOM].[SPED_ALL_STUDENTS_WITH_DISABILITIES] SEDS 
			WHERE SEDS.[SERVICE]='BEHAVIORAL SUPPORT SERVICES'
			AND SEDS.LASTUPDATED='2016-10-15'
			AND EXTENDEDSCHOOLYEAR !='Yes'
			AND SEDS.SERVICELOCATION = 'General Education'
			GROUP BY TIMEUNITS,TIMEFREQUENCY,STATEID) BSSG_SPED ON BSSG_SPED.STATEID=S.STATESTUDENTID
LEFT JOIN (SELECT 
			(str(SUM(TIME),3,1)  +' '+TIMEUNITS+'/'+TIMEFREQUENCY) AS SPED_Related_Speech_GenEd
			,SEDS.STATEID 
			FROM [CUSTOM].[SPED_ALL_STUDENTS_WITH_DISABILITIES] SEDS 
			WHERE SEDS.[SERVICE]='SPEECH-LANGUAGE PATHOLOGY'
			AND SEDS.LASTUPDATED='2016-10-15'
			AND EXTENDEDSCHOOLYEAR !='Yes'
			AND SEDS.SERVICELOCATION = 'General Education'
			GROUP BY TIMEUNITS,TIMEFREQUENCY,STATEID) SLPG_SPED ON SLPG_SPED.STATEID=S.STATESTUDENTID
LEFT JOIN (SELECT 
			(str(SUM(TIME),3,1)  +' '+TIMEUNITS+'/'+TIMEFREQUENCY) AS SPED_Related_OT_GenEd
			,SEDS.STATEID 
			FROM [CUSTOM].[SPED_ALL_STUDENTS_WITH_DISABILITIES] SEDS 
			WHERE SEDS.[SERVICE]='OCCUPATIONAL THERAPY'
			AND SEDS.LASTUPDATED='2016-10-15'
			AND EXTENDEDSCHOOLYEAR !='Yes'
			AND SEDS.SERVICELOCATION = 'General Education'
			GROUP BY TIMEUNITS,TIMEFREQUENCY,STATEID) OTG_SPED ON OTG_SPED.STATEID=S.STATESTUDENTID
LEFT JOIN (SELECT 
			(str(SUM(TIME),3,1)  +' '+TIMEUNITS+'/'+TIMEFREQUENCY) AS SPED_Related_PT_GenEd
			,SEDS.STATEID 
			FROM [CUSTOM].[SPED_ALL_STUDENTS_WITH_DISABILITIES] SEDS 
			WHERE SEDS.[SERVICE]='PHYSICAL THERAPY'
			AND SEDS.LASTUPDATED='2016-10-15'
			AND EXTENDEDSCHOOLYEAR !='Yes'
			AND SEDS.SERVICELOCATION = 'General Education'
			GROUP BY TIMEUNITS,TIMEFREQUENCY,STATEID) PTG_SPED ON PTG_SPED.STATEID=S.STATESTUDENTID
LEFT JOIN (SELECT 
			(str(SUM(TIME),3,1)  +' '+TIMEUNITS+'/'+TIMEFREQUENCY) AS SPED_Related_Audiology_GenEd
			,SEDS.STATEID 
			FROM [CUSTOM].[SPED_ALL_STUDENTS_WITH_DISABILITIES] SEDS 
			WHERE SEDS.[SERVICE]='AUDIOLOGY'
			AND SEDS.LASTUPDATED='2016-10-15'
			AND EXTENDEDSCHOOLYEAR !='Yes'
			AND SEDS.SERVICELOCATION = 'General Education'
			GROUP BY TIMEUNITS,TIMEFREQUENCY,STATEID) AG_SPED ON AG_SPED.STATEID=S.STATESTUDENTID
WHERE 1=1
AND S.STATESTUDENTID !='-----'
```
